{% extends "layout.html" %}

{% block content %}
<h2>{{ title|default('Focused Practice') }}</h2>

<!-- Instructions specific to focus area -->
<p>Use your camera to get real-time feedback specifically on your {{ focus }} posture. The practice will run for 2 minutes, after which you'll see your results.</p>

<!-- Hidden element to store focus for JavaScript -->
<div id="practice-focus" data-focus="{{ session.get('practice_focus', 'all') }}" style="display: none;"></div>
<div id="practice-duration" data-seconds="{{ practice_duration_seconds|default(120) }}" style="display: none;"></div>

<!-- Countdown Timer for Initial Positioning -->
<div id="countdown" class="countdown-timer text-center my-3 p-3 bg-light rounded" style="display: none; font-size: 2em; font-weight: bold;">
    Get ready: 5
</div>

<!-- Practice Timer -->
<div class="practice-time-container text-center mb-3">
    <div class="practice-timer-label">Time Remaining:</div>
    <div id="practice-timer" class="practice-timer">2:00</div>
</div>

{# --- Main Content Area (Video, Feedback etc.) --- #}
<div class="practice-main-area">
    <div id="video-container" style="position: relative; width: 640px; height: 480px; margin: 20px auto; border: 1px solid #ccc;">
        <video id="video" playsinline style="transform: scaleX(-1); width: 100%; height: 100%; object-fit: cover;"></video>
        <canvas id="overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
    </div>
    <div id="feedback" class="mt-3 text-center" style="font-size: 1.2em; min-height: 1.5em;">Waiting to start...</div>
</div>

{# --- Container for Practice Control Buttons --- #}
<div class="d-flex justify-content-center gap-3 mt-4">
    <button id="start-button" class="btn btn-primary">Start Practice</button>
    <button id="end-practice-button" class="btn btn-success" style="display: none;">End Early</button>
</div>

{# --- Container for Bottom Navigation Buttons --- #}
<div class="bottom-nav-controls mt-5">
    {# Previous Button - Links back to the appropriate lesson page based on focus #}
    {% if session.get('practice_focus') == 'head_neck' %}
        <a href="{{ url_for('learn', lesson_number='4') }}" class="btn btn-secondary">&laquo; Back to Head & Neck</a>
    {% elif session.get('practice_focus') == 'shoulders' %}
        <a href="{{ url_for('learn', lesson_number='5') }}" class="btn btn-secondary">&laquo; Back to Shoulders</a>
    {% else %}
        <a href="{{ url_for('learn', lesson_number='3') }}" class="btn btn-secondary">&laquo; Back to Overview</a>
    {% endif %}

    {# Return Home Button #}
    <a href="{{ url_for('homepage') }}" class="btn btn-outline-secondary">Return Home</a>
    
    {# Full Practice Button - only shown if this is a focused practice #}
    {% if session.get('practice_focus') != 'all' %}
        <a href="{{ url_for('practice') }}" class="btn btn-primary">Full Practice &raquo;</a>
    {% endif %}
</div>

<!-- Load the script last -->
<script src="{{ url_for('static', filename='scripts.js') }}"></script>
{% endblock %}
{% extends "layout.html" %}

{% block content %}
<div class="container mt-4">
    <h2 id="lesson_title">Your Posture Results</h2>
    
    <div class="results-container">
        <!-- Results Header -->
        <div class="results-header mb-4 text-center">
            <h3 class="mt-3">
                {% if session.get('practice_focus') == 'head_neck' %}
                    Head & Neck Assessment
                {% elif session.get('practice_focus') == 'shoulders' %}
                    Shoulders Assessment
                {% else %}
                    Overall Posture Assessment
                {% endif %}
            </h3>
            <p class="lead">Based on your {{ session.get('practice_duration', '2:00') }} practice session</p>
        </div>
        
        <!-- Detailed Results -->
        <div class="detailed-results mb-5">
            <h4>Detailed Analysis</h4>
            
            {% if session.get('practice_focus') == 'all' or session.get('practice_focus') == 'head_neck' %}
            <!-- Head & Neck Details -->
            <div class="detail-section mb-4">
                <h5>Head & Neck Position</h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="metric-card">
                            <div class="metric-label">Head Alignment</div>
                            <div class="metric-value">{{ session.get('head_alignment', 'N/A') }}</div>
                            <div class="metric-bar">
                                <div class="progress">
                                    <div class="progress-bar {% if session.get('head_alignment_score', 0) >= 80 %}bg-success{% elif session.get('head_alignment_score', 0) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ session.get('head_alignment_score', 0) }}%;" 
                                         aria-valuenow="{{ session.get('head_alignment_score', 0) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card">
                            <div class="metric-label">Neck Tension</div>
                            <div class="metric-value">{{ session.get('neck_tension', 'N/A') }}</div>
                            <div class="metric-bar">
                                <div class="progress">
                                    <div class="progress-bar {% if session.get('neck_tension_score', 0) >= 80 %}bg-success{% elif session.get('neck_tension_score', 0) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ session.get('neck_tension_score', 0) }}%;" 
                                         aria-valuenow="{{ session.get('neck_tension_score', 0) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card">
                            <div class="metric-label">Gaze Direction</div>
                            <div class="metric-value">{{ session.get('gaze_direction', 'N/A') }}</div>
                            <div class="metric-bar">
                                <div class="progress">
                                    <div class="progress-bar {% if session.get('gaze_direction_score', 0) >= 80 %}bg-success{% elif session.get('gaze_direction_score', 0) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ session.get('gaze_direction_score', 0) }}%;" 
                                         aria-valuenow="{{ session.get('gaze_direction_score', 0) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="recommendation mt-3">
                    <strong>Recommendation:</strong> {{ session.get('head_neck_recommendation', 'Practice daily chin tucks to strengthen your neck and improve alignment.') }}
                </div>
            </div>
            {% endif %}
            
            {% if session.get('practice_focus') == 'all' or session.get('practice_focus') == 'shoulders' %}
            <!-- Shoulders Details -->
            <div class="detail-section mb-4">
                <h5>Shoulders Position</h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="metric-card">
                            <div class="metric-label">Shoulder Level</div>
                            <div class="metric-value">{{ session.get('shoulder_level', 'N/A') }}</div>
                            <div class="metric-bar">
                                <div class="progress">
                                    <div class="progress-bar {% if session.get('shoulder_level_score', 0) >= 80 %}bg-success{% elif session.get('shoulder_level_score', 0) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ session.get('shoulder_level_score', 0) }}%;" 
                                         aria-valuenow="{{ session.get('shoulder_level_score', 0) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card">
                            <div class="metric-label">Shoulder Tension</div>
                            <div class="metric-value">{{ session.get('shoulder_tension', 'N/A') }}</div>
                            <div class="metric-bar">
                                <div class="progress">
                                    <div class="progress-bar {% if session.get('shoulder_tension_score', 0) >= 80 %}bg-success{% elif session.get('shoulder_tension_score', 0) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ session.get('shoulder_tension_score', 0) }}%;" 
                                         aria-valuenow="{{ session.get('shoulder_tension_score', 0) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card">
                            <div class="metric-label">Chest Openness</div>
                            <div class="metric-value">{{ session.get('chest_openness', 'N/A') }}</div>
                            <div class="metric-bar">
                                <div class="progress">
                                    <div class="progress-bar {% if session.get('chest_openness_score', 0) >= 80 %}bg-success{% elif session.get('chest_openness_score', 0) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ session.get('chest_openness_score', 0) }}%;" 
                                         aria-valuenow="{{ session.get('chest_openness_score', 0) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="recommendation mt-3">
                    <strong>Recommendation:</strong> {{ session.get('shoulders_recommendation', 'Perform shoulder rolls and gentle stretches throughout the day to release tension.') }}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Overall Recommendation -->
        <div class="overall-recommendation p-4 mb-4 bg-light border rounded">
            <h4>Your Personalized Plan</h4>
            <p>{{ session.get('overall_recommendation', 'Based on your assessment, we recommend the following daily practice:') }}</p>
            <ul class="recommendation-list">
                {% if session.get('practice_focus') == 'head_neck' %}
                <li>Practice gentle chin tucks several times throughout the day</li>
                <li>Keep your gaze level when working on screens</li>
                <li>Stretch your neck in all directions for 1 minute every hour</li>
                {% elif session.get('practice_focus') == 'shoulders' %}
                <li>Roll your shoulders backward several times per hour</li>
                <li>Gently stretch your chest by clasping hands behind your back</li>
                <li>Keep shoulders relaxed and down while working</li>
                {% else %}
                <li>{{ session.get('recommendation_1', 'Practice 5 minutes of posture awareness at your desk') }}</li>
                <li>{{ session.get('recommendation_2', 'Do 2-3 gentle neck stretches every hour') }}</li>
                <li>{{ session.get('recommendation_3', 'Strengthen your core with 10 minutes of exercises daily') }}</li>
                {% endif %}
            </ul>
            <p class="mt-3">{{ session.get('recommendation_footer', 'Implement these practices consistently for 2 weeks, then return for another assessment to track your progress.') }}</p>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="d-flex justify-content-between mt-5 pt-3 border-top">
            <a href="{{ url_for('feedback_summary') }}" class="btn btn-secondary">&laquo; Back to Summary</a>
            
            {% if session.get('practice_focus') == 'head_neck' %}
            <a href="{{ url_for('practice_head_neck') }}" class="btn btn-primary">Practice Head & Neck Again</a>
            {% elif session.get('practice_focus') == 'shoulders' %}
            <a href="{{ url_for('practice_shoulders') }}" class="btn btn-primary">Practice Shoulders Again</a>
            {% else %}
            <a href="{{ url_for('practice') }}" class="btn btn-primary">Practice Again</a>
            {% endif %}
            
            <a href="{{ url_for('homepage') }}" class="btn btn-secondary">Return Home</a>
        </div>
    </div>
</div>
{% endblock %}
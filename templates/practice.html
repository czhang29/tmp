{% extends "layout.html" %}

{% block content %}
<h2>Practice Your Posture</h2>

<!-- Instructions -->
<p>Use your camera to get real-time feedback on your posture. 
{% if practice_duration_seconds == 0 %}
You can practice for as long as you want. End the session when you're done.
{% else %}
The practice will run for {{ practice_duration_seconds|int // 60 }} minutes, after which you'll see your results.
{% endif %}
</p>

<!-- Hidden element to store practice info for JavaScript -->
<div id="practice-focus" data-focus="{{ session.get('practice_focus', 'all') }}" style="display: none;"></div>
<div id="practice-duration" data-seconds="{{ practice_duration_seconds|default(120) }}" style="display: none;"></div>

<!-- Countdown Timer for Initial Positioning -->
<div id="countdown" class="countdown-timer text-center my-3 p-3 bg-light rounded" style="display: none; font-size: 2em; font-weight: bold;">
    Get ready: 5
</div>

<!-- Practice Timer -->
<div class="practice-time-container text-center mb-3">
    <div class="practice-timer-label">Time Remaining:</div>
    <div id="practice-timer" class="practice-timer">
        {% if practice_duration_seconds == 0 %}
        No time limit
        {% else %}
        {{ practice_duration_seconds|int // 60 }}:{% if practice_duration_seconds % 60 < 10 %}0{% endif %}{{ practice_duration_seconds % 60 }}
        {% endif %}
    </div>
</div>

{# --- Main Content Area (Video, Feedback etc.) --- #}
<div class="practice-main-area">
    <div id="video-container" style="position: relative; width: 640px; height: 480px; margin: 20px auto; border: 1px solid #ccc;">
        <video id="video" playsinline style="transform: scaleX(-1); width: 100%; height: 100%; object-fit: cover;"></video>
        <canvas id="overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
    </div>
    <div id="feedback" class="mt-3 text-center" style="font-size: 1.2em; min-height: 1.5em;">Waiting to start...</div>
</div>

{# --- Container for Start Practice Button --- #}
<div class="d-flex justify-content-center gap-3 mt-4">
    <button id="start-button" class="btn btn-primary">Start Practice</button>
    <button id="end-practice-button" class="btn btn-success" style="display: none;">End Session</button>
</div>

{# --- Audio Toggle --- #}
<div id="audio-toggle" class="audio-status">
    <i class="fas fa-volume-up"></i>
</div>

{# --- Container for Bottom Navigation Buttons --- #}
<div class="bottom-nav-controls mt-5">
    {# Previous Button - Links to last lesson or homepage #}
    {% if session.get('in_learning_flow') %}
        <a href="{{ url_for('learn', lesson_number='5') }}" class="btn btn-secondary">&laquo; Back to Learning</a>
    {% else %}
        <a href="{{ url_for('homepage') }}" class="btn btn-secondary">&laquo; Back to Home</a>
    {% endif %}

    {# Return Home Button #}
    <a href="{{ url_for('homepage') }}" class="btn btn-primary">Return Home</a>
</div>

<!-- Import Font Awesome for audio icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- Load the script last -->
<script src="{{ url_for('static', filename='scripts.js') }}"></script>
{% endblock %}